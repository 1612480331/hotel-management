<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.hotelmanagement.mapper.bookMapper">
    <select id="queryBookByBookId" resultType="com.example.hotelmanagement.entity.book" >
        select * from book where bookId=#{bookId};
    </select>

    <insert id="bookToHistory">
        insert into history(bookId, arrive, depart, money, phone, state)
            values(#{bookId},#{arrive},#{depart},#{money},#{phone},#{state});
    </insert>

    <delete id="deleteBook">
        delete from book where bookId = #{bookId}
    </delete>

    <update id="payOrder">
        update book set response = '待处理' where bookId=#{bookId} and response='待支付'
    </update>

    <select id="queryRemainByDate" resultType="com.example.hotelmanagement.entity.remainRoom">
        select typeName,v_roomType_number.typeNumber-sum(v_orderState.roomNumber) as remain
	        from v_roomType_number,v_orderState
                where v_roomType_number.typeName=v_orderState.roomType
                and (#{date} between v_orderState.arrive and v_orderState.depart)
                    group by roomType;
    </select>

    <select id="queryBookByPhone" resultType="com.example.hotelmanagement.entity.book" >
        select * from book where phone=#{phone};
    </select>

    <select id="queryBookByPhoneAndArrive" resultType="com.example.hotelmanagement.entity.book" >
        select * from book where phone=#{phone} and arrive=date(#{arrive});
    </select>

    <insert id="addOrder">
        insert into book(roomType,roomNumber,arrive,depart,orderPrice,payState,phone)
            values(#{roomType},#{roomNumber},#{arrive},#{depart},#{orderPrice},#{payState},#{phone});
    </insert>
</mapper>
